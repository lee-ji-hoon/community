<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="theme-fragments.html :: head"></head>
<body>

<div id="wrapper">

    <!-- Header -->
    <header th:replace="theme-fragments.html :: header"></header>

    <!-- sidebar -->
    <div th:replace="theme-fragments.html :: side_bar(currentSideMenu='market')"></div>

    <!-- Main Contents -->
    <div class="main_content">
        <div class="mcontainer">
            <div class="breadcrumb-area py-0">
                <div class="breadcrumb">
                    <ul class="m-0">
                        <li>
                            <a th:href="@{/market}">장터</a>
                        </li>
                        <li>
                            <a style="font-weight: bold" href="#"> 상세보기</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="lg:flex lg:space-x-10">
                <div class="lg:w-3/4 lg:px-20 space-y-7">



                    <div class="card lg:mx-0 uk-animation-slide-bottom-small">

                        <!-- post header-->
                        <div class="flex justify-between items-center lg:p-4 p-2.5">
                            <div class="flex flex-1 items-center space-x-4">
                                <a href="#">
                                    <svg th:if="${#strings.isEmpty(product.seller.profileImage)}"
                                         th:data-jdenticon-value="${product.seller.studentId}"
                                         class="bg-gray-200 border border-white rounded-full w-10 h-10">
                                    </svg>
                                    <img th:if="${!#strings.isEmpty(product.seller.profileImage)}"
                                         th:src="${product.seller.profileImage}" alt=""
                                         class="bg-gray-200 border border-white rounded-full w-10 h-10">
                                </a>
                                <div class="flex-1 font-semibold capitalize">
                                    <a href="#" class="text-black" th:text="${product.seller.nickname}"> Johnson smith </a>
                                    <div th:text="${product.marketType}" class="text-sm"></div>
                                    <span th:text="${#temporals.format(product.itemUploadTime,  'yyyy-MM-dd')}"></span>
                                </div>
                            </div>
                            <div th:if="${account.username.equals(product.seller.username)}">
                                <a href="#"> <i class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"></i> </a>
                                <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
                                     uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small">

                                    <ul class="space-y-1">
                                        <li>
                                            <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                                판매 중
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                                판매 완료
                                            </a>
                                        </li>
                                        <hr/>
                                        <li>
                                            <a href="#" class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                                <i class="uil-edit-alt mr-1"></i> 수정
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md dark:hover:bg-red-600">
                                                <i class="uil-trash-alt mr-1"></i> 삭제
                                            </a>
                                        </li>
                                    </ul>

                                </div>
                            </div>
                        </div>

                        <div uk-lightbox>
                            <a href="assets/images/avatars/avatar-lg-3.jpg">
                                <img src="assets/images/product/15.jpg" alt="" class="max-h-96 w-full object-cover">
                            </a>
                        </div>

                        <div class="p-4 space-y-3 relative">
                            <div class="text-2xl font-semibold pt-2" th:text="${product.itemName}"> Product title</div>
                            <p th:utext="${product.itemDetail}"> 물건 설명</p>

                            <div th:text="${product.price + '원'}"
                                 class="top-3 absolute bg-gray-100 font-semibold px-3 py-1 right-3 rounded-full text text-sm">
                                $56.99
                            </div>

                            <div class="flex space-x-3 items-center text-sm md:pt-3">
                                <div class="flex">물건 상태 :
                                    <span th:text="${product.itemStatus}"
                                          class="font-semibold text-sm ml-1"> 상태</span>
                                </div>

                                <div class="flex">
                                    <span class="font-semibold text-yellow-500 mr-2" th:text="${product.marketItemStatus}">판매 중</span>
<!--                                    <span class="font-semibold text-yellow-500 mr-2" th:text="${product.byeAndSell}">판매완료 </span>-->
                                </div>
                            </div>

                            <hr>

                            <div class="grid grid-cols-2 gap-4 mb-5">

                                <a href="timeline-page.html" class="bg-gray-200 flex flex-1 font-semibold h-10 items-center justify-center px-4 rounded-md">
                                    쪽지
                                </a>
                                <a href="timeline-page.html" class="bg-blue-600 flex flex-1 font-semibold h-10 items-center justify-center px-4 rounded-md text-white">
                                    찜
                                </a>
                            </div>
                        </div>
                        <div class="card p-6 relative">
                            <h3 class="mb-8 mt-2 font-semibold text-xl"> 댓글 작성하기 </h3>
                            <div class="bg-gray-100 rounded-full relative dark:bg-gray-800 border-t">
                                <form id="reply_form" onsubmit="return false">
                                    <input type="hidden" id="r_board_id" name="r_board_id" class="form-control"
                                           value="1" th:value="${marketId}" readonly>
                                    <input type="hidden" id="r_account_id" name="r_account_id" class="form-control"
                                           value="1" th:value="${account.id}" readonly>
                                    <input type="text" id="r_content" placeholder="여러분의 소중한 댓글을 입력해주세요." name="r_content" class="bg-transparent max-h-10 shadow-none px-5">
                                    <div class="-m-0.5 absolute bottom-0 flex items-center right-3 text-xl">
                                        <a class="write_reply">
                                            <ion-icon name="return-down-back-outline" class="hover:bg-gray-200 p-1.5 rounded-full"></ion-icon>
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                    <div class="card p-6">
                        <div class="reply_div">
                            <h1 class="block text-lg font-semibold mb-4">Comments (<a th:text="${reply.size()}"></a>)</h1>

                            <div class="space-y-5">

                                <div th:each="reply : ${reply}" class="flex gap-x-4 relative rounded-md">
                                    <svg th:if="${#strings.isEmpty(reply.getAccount()?.profileImage)}"
                                         th:data-jdenticon-value="${reply.getAccount().studentId}"
                                         alt="" class="rounded-full shadow w-12 h-12 is_avatar"></svg>
                                    <img th:if="${!#strings.isEmpty(reply.getAccount()?.profileImage)}"
                                         th:src="${reply.getAccount()?.profileImage}"
                                         alt="" class="rounded-full shadow w-12 h-12 is_avatar"/>
                                    <th:block th:if="${reply.getAccount().id == account.id}">
                                        <div class="absolute right-5 top-0 text-red-500" uk-tooltip="댓글 수정">
                                            <div class="reply_update_modal">
                                                <a th:href="'#create-post-modal'+${reply.rid}" uk-toggle class="h-10 w-10 z-10 text-blue-500">
                                                    <i class="fa fa-cog" id="updateFormBtn1"></i>
                                                    <span>수정</span>
                                                </a>
                                                <!-- Craete video post modal -->
                                                <div th:id="'create-post-modal'+${reply.rid}" class="create-post" uk-modal>
                                                    <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical shadow-2xl uk-animation-slide-bottom-small">

                                                        <div class="py-4 border-b flex  justify-between px-6">
                                                            <h3 class="text-lg font-semibold"> 댓글 수정하기 </h3>
                                                            <div>
                                                                <button class="uk-modal-close-default hover:bg-gray-100 rounded-full p-2.5 block uk-icon uk-close mt-0.5"
                                                                        type="button" uk-close>
                                                                    <i class="icon-feather-close"></i>
                                                                </button>
                                                            </div>
                                                        </div>

                                                        <form class="space-y-4 g:w-8/12" onsubmit="return false" id="reply_update_form">
                                                            <div class="create-post-modal-body space-x-6 p-5 overflow-x-hidden mr-1 max-h-fit" data-simplebar>
                                                                <div class="space-y-4 g:w-8/12">
                                                                    <div class="font-semibold text-lg"> 댓글 수정 </div>
                                                                    <a th:text="${reply.rid}"></a>
                                                                    <div class="border focus-within:border-blue-300 p-3 pb-0 rounded-md form-group d-none">
                                                                        <label for="writer" class="mb-0 ml-2 text-gray-600 text-sm">rid</label>
                                                                        <input type="hidden" placeholder="닉네임 입력해주세요."
                                                                               name="reply_update_rid" readonly th:value="${reply.rid}"
                                                                               id="reply_update_rid"
                                                                               class="-mt-2 -mx-3 bg-transparent focus:bg-white focus:ring-gray-300 h-8 outline-none px-0 text-base w-full form-control">
                                                                    </div>
                                                                    <div class="border focus-within:border-blue-300 p-3 rounded-md form-group">
                                                                        <label for="reply_update_content" class="mb-0 ml-2 text-gray-600 text-sm"> Description</label>
                                                                        <textarea type="text" rows="5" placeholder="내용을 입력해주세요." name="reply_update_content" id="reply_update_content"
                                                                                  required th:text="${reply.content}"
                                                                                  class="bg-transparent focus:bg-white focus:ring-gray-300 focus:shadow-none outline-none p-2 resize-none shadow-none text-base w-full form-control"></textarea>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="flex items-center w-full justify-between p-3 border-t">
                                                                <div class="flex items-center space-x-2">
                                                                    <div></div>
                                                                </div>

                                                                <div class="flex space-x-2">
                                                                    <a th:href="@{/board/detail/reply/delete/{rid}(rid=${reply.rid})}"
                                                                       class="bg-red-100 flex font-medium h-9 items-center justify-center px-5 rounded-md text-red-600 text-sm">
                                                                        삭제하기 </a>
                                                                    <button id = "update_reply"
                                                                            class="uk-modal-close bg-blue-600 flex h-9 items-center justify-center rounded-md text-white px-5 font-medium">
                                                                        수정하기 </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </th:block>
                                    <th:block th:if="${reply.getAccount().id != account.id}">
                                        <div class="absolute right-5 top-0 text-red-500" uk-tooltip="댓글 신고">
                                            <a th:href="@{/reply/report/{replyId}(replyId = ${reply.rid})}">
                                                <i class="fa fa-bullhorn" aria-hidden="true"></i>
                                                <span class="likes">신고</span>
                                            </a>
                                        </div>
                                    </th:block>
                                    <br>
                                    <!--<a href="#" class="bg-gray-100 py-1.5 px-4 rounded-full absolute right-5 top-0">Replay</a>-->
                                    <div>
                                        <a th:href="@{/profile/{nickname}(nickname=${reply.getAccount().nickname})}"><h4 class="text-base m-0 font-semibold" th:text="${reply.getAccount().nickname}">댓글 작성자</h4></a>
                                        <span class="text-gray-700 text-sm" th:text="${service.boardDateTime(reply.uploadTime)}"></span>
                                        <th:block th:if="${!reply.getIsReported}">
                                            <p class="mt-3 md:ml-0 -ml-16" th:text="${reply.content}">내용</p>
                                        </th:block>
                                        <th:block th:if="${reply.getIsReported}">
                                            <p class="mt-3 md:ml-0 -ml-16">신고된 댓글입니다.</p>
                                        </th:block>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:w-72 w-full">

                    <a href="#birthdays" uk-toggle>
                        <div class="bg-white mb-5 px-4 py-3 rounded-md shadow">
                            <h3 class="text-line-through font-semibold mb-1"> Birthdays </h3>
                            <div class="-mx-2 duration-300 flex hover:bg-gray-50 px-2 py-2 rounded-md">
                                <img src="assets/images/icons/gift-icon.png" class="w-9 h-9 mr-3" alt="">
                                <p class="line-clamp-2 leading-6"> <strong> Jessica Erica </strong> and <strong> two others </strong>
                                    have a birthdays to day .
                                </p>
                            </div>
                        </div>
                    </a>

                    <h3 class="text-xl font-semibold"> Contacts </h3>

                    <div class="" uk-sticky="offset:80">

                        <nav class="responsive-nav border-b extanded mb-2 -mt-2">
                            <ul uk-switcher="connect: #group-details; animation: uk-animation-fade">
                                <li class="uk-active"><a class="active" href="#0">  Friends  <span> 310 </span> </a></li>
                                <li><a href="#0">Groups</a></li>
                            </ul>
                        </nav>

                        <div class="contact-list">

                            <a href="#">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-1.jpg" alt="">
                                    <span class="user_status status_online"></span>
                                </div>
                                <div class="contact-username"> Dennis Han</div>
                            </a>
                            <div uk-drop="pos: left-center ;animation: uk-animation-slide-left-small">
                                <div class="contact-list-box">
                                    <div class="contact-avatar">
                                        <img src="assets/images/avatars/avatar-2.jpg" alt="">
                                        <span class="user_status status_online"></span>
                                    </div>
                                    <div class="contact-username">   Dennis Han</div>
                                    <p>
                                        <ion-icon name="people" class="text-lg mr-1"></ion-icon> Become friends with
                                        <strong> Stella Johnson </strong> and <strong> 14 Others</strong>
                                    </p>
                                    <div class="contact-list-box-btns">
                                        <button type="button" class="button primary flex-1 block mr-2">
                                            <i class="uil-envelope mr-1"></i> Send message</button>
                                        <button type="button"  href="#" class="button secondary button-icon mr-2">
                                            <i class="uil-list-ul"> </i> </button>
                                        <button type="button" a href="#" class="button secondary button-icon">
                                            <i class="uil-ellipsis-h"> </i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <a href="#">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-2.jpg" alt="">
                                    <span class="user_status"></span>
                                </div>
                                <div class="contact-username"> Erica Jones</div>
                            </a>
                            <div uk-drop="pos: left-center ;animation: uk-animation-slide-left-small">
                                <div class="contact-list-box">
                                    <div class="contact-avatar">
                                        <img src="assets/images/avatars/avatar-1.jpg" alt="">
                                        <span class="user_status"></span>
                                    </div>
                                    <div class="contact-username">  Erica Jones </div>
                                    <p>
                                        <ion-icon name="people" class="text-lg mr-1"></ion-icon> Become friends with
                                        <strong> Stella Johnson </strong> and <strong> 14 Others</strong>
                                    </p>
                                    <div class="contact-list-box-btns">
                                        <button type="button" class="button primary flex-1 block mr-2">
                                            <i class="uil-envelope mr-1"></i> Send message</button>
                                        <button type="button"  href="#" class="button secondary button-icon mr-2">
                                            <i class="uil-list-ul"> </i> </button>
                                        <button type="button" a href="#" class="button secondary button-icon">
                                            <i class="uil-ellipsis-h"> </i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <a href="timeline.html">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-5.jpg" alt="">
                                    <span class="user_status status_online"></span>
                                </div>
                                <div class="contact-username">Stella Johnson</div>
                            </a>
                            <a href="timeline.html">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-6.jpg" alt="">
                                </div>
                                <div class="contact-username"> Alex Dolgove</div>
                            </a>

                            <a href="timeline.html">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-1.jpg" alt="">
                                    <span class="user_status status_online"></span>
                                </div>
                                <div class="contact-username"> Dennis Han</div>
                            </a>
                            <a href="timeline.html">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-2.jpg" alt="">
                                    <span class="user_status"></span>
                                </div>
                                <div class="contact-username"> Erica Jones</div>
                            </a>
                            <a href="timeline.html">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-7.jpg" alt="">
                                </div>
                                <div class="contact-username">Stella Johnson</div>
                            </a>
                            <a href="timeline.html">
                                <div class="contact-avatar">
                                    <img src="assets/images/avatars/avatar-4.jpg" alt="">
                                </div>
                                <div class="contact-username"> Alex Dolgove</div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="application/javascript" th:inline="javascript">
    $(document).ready(function () {
        $('#content').summernote({
            placeholder: '글의 내용을 입력해주세요.<br/>타인에게 불쾌감을 주는 글은 예고없이 삭제됩니다.<br/>또한 신고가 누적될 시 제재가 있을 수 있습니다.',
            tabsize: 2,
            toolbar: [
                ['font', ['bold', 'italic', 'underline', 'clear']],
            ],
            maxHeight: null,
            minHeight: null,
            lang: 'ko-KR',
            height: 500,
        });
        // input에 있는 값을 가져옴
        var input = document.getElementById("r_content");
        input.addEventListener('keypress', function (key) {
            if (input.value == '' && key.key == 'Enter') {
                alert("댓글을 입력해주세요.");
            }
            if (input.value != '' && key.key == 'Enter') {
                $.ajax({
                    url: '/market/reply',
                    type: 'get',
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    data: $('#reply_form').serialize(),
                    dataType: "json",
                    success: function () {
                        console.log("Write Reply Success");
                        $('.reply_div').load(location.href + ' .reply_div');
                        input.value = '';
                    },
                    error: function (request, status, error) {
                        console.log("Write Reply Fail" + error);
                    }
                });
            }
        });
        $(document).on('click', '.write_reply', function () {
            if (input.value == '') {
                alert("댓글을 입력해주세요.");
            }
            if (input.value != '') {
                console.log("댓글 작성");
                $.ajax({
                    url: '/market/reply',
                    type: 'get',
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    data: $('#reply_form').serialize(),
                    dataType: "json",
                    success: function () {
                        console.log("Write Reply Success");
                        $('.reply_div').load(location.href + ' .reply_div');
                        input.value = '';
                    },
                    error: function (request, status, error) {
                        console.log("Write Reply Fail" + error);
                    }
                });
            }
        });
        var reply_input = document.getElementById("reply_update_content");
        $(document).on('click', '#update_reply', function () {
            if (reply_input.value == '') {
                alert("댓글을 입력해주세요.");
            }
            if (reply_input.value != '') {
                console.log("댓글 수정");
                $.ajax({
                    url: '/market/reply/update',
                    type: 'get',
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    data: $('#reply_update_form').serialize(),
                    dataType: "json",
                    success: function () {
                        console.log("Reply Update Success");
                        $('.reply_div').load(location.href + ' .reply_div');
                        $('#reply_update_form').load(location.href + ' #reply_update_form');
                    },
                    error: function (request, status, error) {
                        console.log("Reply Update Fail" + error);
                    }
                });
            }
        });
    })
</script>
</body>
</html>
