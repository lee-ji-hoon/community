<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="theme-fragments.html :: head"></head>
<style>
    #utextDiv{
        overflow:hidden; word-wrap:break-word;
    }
</style>
<body>
    


    <div id="wrapper">

        <!-- Header -->
        <header th:replace="theme-fragments.html :: header"></header>

        <!-- sidebar -->
        <div th:replace="theme-fragments.html :: side_bar(currentSideMenu='board')"></div>

        <!-- Main Contents -->
        <div class="main_content">
            <div class="mcontainer">

                <div class="lg:flex lg:space-x-10">
                      
                    <div class="lg:w-3/4 space-y-5">
                        <div id="isUpdatedForm">
                            <div id="isUpdated"></div>
                        </div>
                        <div class="card">
                            <div class="h-44 mb-4 md:h-72 overflow-hidden relative rounded-t-lg w-full">
                                <img src="/assets/images/blog/img-4.jpg" alt="" class="w-full h-full absolute inset-0 object-cover">
                            </div>
                            <div class="form_refresh">
                                <div class="p-7">
                                    <h1 class="lg:text-3xl text-2xl font-semibold mb-6" th:text="${board.title}">제목</h1>
                                    <div class="flex items-center space-x-3 my-4 pb-4 border-b border-gray-100">
                                        <svg th:if="${#strings.isEmpty(boardOwner?.profileImage)}"
                                             th:data-jdenticon-value="${boardOwner.nickname}"
                                             alt="" class="w-10 rounded-full is_avatar"></svg>
                                        <img th:if="${!#strings.isEmpty(boardOwner?.profileImage)}"
                                             th:src="${boardOwner?.profileImage}"
                                             alt="" class="w-10 rounded-full is_avatar"/>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <div class="text-base font-semibold"><a th:href="@{/profile/{nickname}(nickname=${board.getWriter().nickname})}" th:text="${board.getWriter().nickname}"></a></div>
                                                <div class="text-xs" th:text="${service.boardDateTime(board.uploadTime)}">게시물 시간</div>
                                            </div>
                                            <!-- Board 작성자면 뜨는 수정폼 -->
                                            <th:block th:if="${boardOwner.id==account.id}">
                                                <div>
                                                    <a href="#create-post-modal" uk-toggle class="flex items-center justify-center h-10 w-10 z-10 rounded-full bg-blue-600 text-white absolute"
                                                       data-tippy-placement="right" title="게시물 수정하기">
                                                        <i class="fa fa-cog fa-2x" id="updateFormBtn"></i>
                                                    </a>
                                                    <!-- Craete video post modal -->
                                                    <div id="create-post-modal" class="create-post" uk-modal>
                                                        <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical shadow-2xl uk-animation-slide-bottom-small">

                                                            <div class="py-4 border-b flex  justify-between px-6">
                                                                <h3 class="text-lg font-semibold"> 게시글 작성하기 </h3>
                                                                <div>
                                                                    <button class="uk-modal-close-default hover:bg-gray-100 rounded-full p-2.5 block uk-icon uk-close mt-0.5"
                                                                            type="button" uk-close>
                                                                        <i class="icon-feather-close"></i>
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            <form class="space-y-4 g:w-8/12" id="board_form" onsubmit="return false">
                                                                <div class="create-post-modal-body space-x-6 p-5 overflow-x-hidden mr-1 max-h-screen" data-simplebar>
                                                                    <div class="space-y-4 g:w-8/12">
                                                                        <div class="px-2 space-y-2 d-none">
                                                                            <div class="font-semibold text-base"> 게시판 bid </div>
                                                                            <input type="hidden" placeholder="bid를 입력해주세요." id="bid"
                                                                                   th:value="${board.bid}" name="bid" readonly
                                                                                   aria-describedby="writerHelp"
                                                                                   class="-mt-2 -mx-3 bg-transparent focus:bg-white focus:ring-gray-300 h-8 outline-none px-0 text-base w-full form-control">

                                                                        </div>
                                                                        <div class="font-semibold text-lg"> 게시글 수정 </div>
                                                                        <div class="border focus-within:border-blue-300 p-3 pb-0 rounded-md form-group d-none">
                                                                            <label for="writer" class="mb-0 ml-2 text-gray-600 text-sm">작성자</label>
                                                                            <input type="hidden" placeholder="닉네임 입력해주세요." id="writer"
                                                                                   th:value="${boardOwner.nickname}" name="writer" readonly
                                                                                   aria-describedby="writerHelp"
                                                                                   class="-mt-2 -mx-3 bg-transparent focus:bg-white focus:ring-gray-300 h-8 outline-none px-0 text-base w-full form-control">
                                                                        </div>
                                                                        <div class="border focus-within:border-blue-300 p-3 pb-0 rounded-md form-group">
                                                                            <label for="boardTitle" class="mb-0 ml-2 text-gray-600 text-sm">게시판 선택</label>
                                                                            <select class="" th:value="${board.boardTitle}" name="boardTitle" id="boardTitle">
                                                                                <option data-icon="icon-material-outline-assignment" value="자유게시판" th:selected="${board.boardTitle}=='자유게시판'">자유게시판</option>
                                                                                <option data-icon="icon-material-outline-access-alarm" value="신입생게시판" th:selected="${board.boardTitle}=='신입생게시판'">신입생게시판</option>
                                                                                <option data-icon="icon-material-outline-account-circle" value="졸업생게시판" th:selected="${board.boardTitle}=='졸업생게시판'">졸업생게시판</option>
                                                                            </select>
                                                                        </div>
                                                                        <div class="border focus-within:border-blue-300 p-3 pb-0 rounded-md form-group">
                                                                            <label for="title" class="mb-0 ml-2 text-gray-600 text-sm">Title</label>
                                                                            <input type="text" placeholder="제목을 입력해주세요." id="title"
                                                                                   name="title"
                                                                                   aria-describedby="titleHelp" required
                                                                                   th:value="${board.title}"
                                                                                   class="-mt-2 -mx-3 bg-transparent focus:bg-white focus:ring-gray-300 h-8 outline-none px-0 text-base w-full form-control">
                                                                        </div>
                                                                        <div class="border focus-within:border-blue-300 p-3 rounded-md form-group">
                                                                            <label for="content" class="mb-0 ml-2 text-gray-600 text-sm"> Description</label>
                                                                            <textarea type="text" rows="5" placeholder="내용을 입력해주세요." id="content" name="content"
                                                                                      aria-describedby="contentHelp" required
                                                                                      th:text="${board.content}"
                                                                                      class="bg-transparent focus:bg-white focus:ring-gray-300 focus:shadow-none outline-none p-2 resize-none shadow-none text-base w-full form-control"></textarea>
                                                                        </div>

                                                                    </div>

                                                                </div>

                                                                <div class="flex items-center w-full justify-between p-3 border-t">

                                                                    <div class="flex items-center space-x-2">

                                                                        <div></div>

                                                                    </div>

                                                                    <div class="flex space-x-2">
                                                                        <a th:href="@{/board/detail/{boardId}/delete(boardId=${board.bid})}"
                                                                           class="bg-red-100 flex font-medium h-9 items-center justify-center px-5 rounded-md text-red-600 text-sm">
                                                                            삭제하기 </a>
                                                                        <button
                                                                                class="uk-modal-close bg-blue-600 flex h-9 items-center justify-center rounded-md text-white px-5 font-medium board_form_send">
                                                                            수정하기 </button>
                                                                    </div>

                                                                    <button hidden
                                                                            class="bg-blue-600 flex h-9 items-center justify-center rounded-lg text-white px-12 font-semibold board_form_send">
                                                                        수정하기 </button>
                                                                </div>
                                                            </form>

                                                        </div>
                                                    </div>
                                                </div>
                                            </th:block>
                                        </div>
                                    </div>
                                    <div id="utextDiv">
                                        <div class="space-y-3" th:utext="${board.content}"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card p-6 relative">
                            <div class="flex space-x-4 lg:font-bold">
                                <a href="#" class="flex items-center space-x-2">
                                    <div class="p-2 rounded-full text-black lg:bg-gray-10 like_div">
                                        <th:block th:if="${likes.isEmpty()}">
                                            <form id="like_add" class="float-left">
                                                <input type="hidden" id="like_boardId" name="like_boardId" th:value="${board.bid}"/>
                                                <input type="hidden" id="like_accountId" name="like_accountId" th:value="${account.id}"/>
                                                <a class="like_heart_click btn btn-link"><i class="fa fa-thumbs-up"></i> 좋아요</a>
                                            </form>
                                        </th:block>
                                        <th:block th:if="${likes.isPresent()}">
                                            <form id="like_cancel" class="float-left">
                                                <input type="hidden" name="like_boardId" th:value="${board.bid}"/>
                                                <input type="hidden" name="like_accountId" th:value="${account.id}"/>
                                                <a class="like_heart_click btn btn-link"><i class="fa fa-thumbs-down"></i> 좋아요 취소</a>
                                            </form>
                                        </th:block>
                                        <!--<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="22" height="22" class="dark:text-gray-100">
                                            <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
                                        </svg>-->
                                    </div>
                                    <!--<div> Like</div>-->
                                </a>
                                <a href="#" class="flex items-center space-x-2 flex-1 justify-end">
                                    <div class="p-2 rounded-full text-black lg:bg-gray-10">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="22" height="22" class="dark:text-gray-100">
                                            <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                                        </svg>
                                    </div>
                                    <div> Share</div>
                                </a>
                            </div>
                        </div>
                        <!-- related articles -->
                        <div class="card p-6 relative">

                            <h3 class="mb-8 mt-2 font-semibold text-xl"> 댓글 작성하기 </h3>
                            <div class="bg-gray-100 rounded-full relative dark:bg-gray-800 border-t">
                                <form id="reply_form" onsubmit="return false">
                                    <input type="hidden" id="r_board_id" name="r_board_id" class="form-control"
                                           value="1" th:value="${board.bid}" readonly>
                                    <input type="hidden" id="r_account_id" name="r_account_id" class="form-control"
                                           value="1" th:value="${account.id}" readonly>
                                    <input type="text" id="r_content" placeholder="여러분의 소중한 댓글을 입력해주세요." name="r_content" class="bg-transparent max-h-10 shadow-none px-5">
                                    <div class="-m-0.5 absolute bottom-0 flex items-center right-3 text-xl">
                                        <a class="write_reply">
                                            <ion-icon name="return-down-back-outline" class="hover:bg-gray-200 p-1.5 rounded-full"></ion-icon>
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="card p-6">
                            <div class="reply_div">
                                <h1 class="block text-lg font-semibold mb-4">Comments (<a th:text="${replyService.boardReplySize(board)}"></a>)</h1>

                                <div class="space-y-5">

                                    <div th:each="reply : ${reply}" class="flex gap-x-4 relative rounded-md">
                                        <svg th:if="${#strings.isEmpty(reply.getAccount()?.profileImage)}"
                                             th:data-jdenticon-value="${reply.getAccount().nickname}"
                                             alt="" class="rounded-full shadow w-12 h-12 is_avatar"></svg>
                                        <img th:if="${!#strings.isEmpty(reply.getAccount()?.profileImage)}"
                                             th:src="${reply.getAccount()?.profileImage}"
                                             alt="" class="rounded-full shadow w-12 h-12 is_avatar"/>
                                        <a href="#" class="bg-gray-100 py-1.5 px-4 rounded-full absolute right-5 top-0">Replay</a>
                                        <div>
                                            <a th:href="@{/profile/{nickname}(nickname=${reply.getAccount().nickname})}"><h4 class="text-base m-0 font-semibold" th:text="${reply.getAccount().nickname}">댓글 작성자</h4></a>
                                            <span class="text-gray-700 text-sm" th:text="${service.boardDateTime(reply.uploadTime)}"></span>
                                            <th:block th:if="${!reply.getIsReported}">
                                                <p class="mt-3 md:ml-0 -ml-16" th:text="${reply.content}">내용</p>
                                            </th:block>
                                            <th:block th:if="${reply.getIsReported}">
                                                <p class="mt-3 md:ml-0 -ml-16">신고된 댓글입니다.</p>
                                            </th:block>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                    <div class="lg:w-1/4 w-full"> 
   
                        <div uk-sticky="offset:100" class="uk-sticky">
  
                            <h2 class="text-lg font-semibold mb-3"> 최근 올라온 글</h2>
                            <ul>
                            <li th:each="recent : ${recentlyBoards}">
                                <a th:href="@{/board/detail/{boardId}(boardId = ${recent.bid})}" class="hover:bg-gray-100 rounded-md p-2 -mx-2 block">
                                    <h3 class="font-medium line-clamp-2" th:text="${recent.title}"></h3>
                                    <div class="flex items-center my-auto text-xs space-x-1.5">
                                        <div th:text="${service.boardDateTime(recent.uploadTime)}"></div> <div class="pb-1"> . </div>
                                        <ion-icon name="chatbox-ellipses-outline"></ion-icon> <div th:text="${replyService.boardReplySize(recent)}"></div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                            <br>
                          </div>


                    </div>

                </div>

        
            </div>
        </div>
        
    </div>

    <script type="application/javascript" th:inline="javascript">
        $(document).ready(function (){

            // input에 있는 값을 가져옴
            var input = document.getElementById("r_content");
            input.addEventListener('keypress', function(key){
                if (input.value == '' && key.key == 'Enter') {
                    alert("댓글을 입력해주세요.");
                }
                if(input.value != '' && key.key == 'Enter'){
                    $.ajax({
                        url:'/board/detail/reply',
                        type:'get',
                        contentType: "application/x-www-form-urlencoded; charset=utf-8",
                        data : $('#reply_form').serialize(),
                        dataType : "json",
                        success : function (){
                            console.log("Write Reply Success");
                            $('.reply_div').load(location.href+' .reply_div');
                            input.value ='';
                        },
                        error : function (request, status, error){
                            console.log("Write Reply Fail" + error);
                        }
                    });
                }
            });
            $(document).on('click', '.like_heart_click', function() {
                // .like_heart_click은 <a></a>태그의 class 이름
                // 해당 태그를 클릭하면 진행되는 메소드
                if($(this).children('i').attr('class') == "fa fa-thumbs-up"){
                    // this는 클릭한 태그 전역
                    // a 태그 하위에 있는 i 태그의 class가 fa fa-thumbs-up일 때
                    console.log("좋아요 실행");
                    $.ajax({
                        url:'/board/detail/like',
                        type:'get',
                        contentType: "application/x-www-form-urlencoded; charset=utf-8",
                        data : $('#like_add').serialize(),
                        dataType : "json",
                        success : function (like_size){
                            console.log("Like Hit Success");
                            $("#like_result").html(like_size);
                            $('.like_div').load(location.href+' .like_div');
                            $(".like_heart_click").html("<i class=\"fa fa-thumbs-down\"></i> 좋아요 취소");
                        },
                        error : function (request, status, error){
                            console.log("Like Hit Fail" + error);
                        }
                    });
                }else if($(this).children('i').attr('class') == "fa fa-thumbs-down"){
                    console.log("좋아요 취소 실행");
                    $.ajax({
                        url:'/board/detail/like-cancel',
                        type:'get',
                        contentType: "application/x-www-form-urlencoded; charset=utf-8",
                        data : $('#like_cancel').serialize(),
                        dataType : "json",
                        success : function (like_size){
                            console.log("Like Hit Success");
                            $("#like_result").html(like_size);
                            $('.like_div').load(location.href+' .like_div');
                            $(".like_heart_click").html("<i class=\"fa fa-thumbs-up\"></i> 좋아요");
                        },
                        error : function (request, status, error){
                            console.log("Like Hit Fail");
                        }
                    });
                }
            });
            /*$('#updateFormBtn').click(function () {
                console.log("업데이트 폼 버튼 클릭");
                console.log("isUpdated 비움");
                $('#isUpdated').load(window.location.href+' #isUpdated');
                console.log("isUpdated 새로고침");
            });*/
            $(document).on('click', '.write_reply', function() {
                if (input.value == '') {
                    alert("댓글을 입력해주세요.");
                }
                if (input.value != '') {
                    console.log("댓글 작성");
                    $.ajax({
                        url:'/board/detail/reply',
                        type:'get',
                        contentType: "application/x-www-form-urlencoded; charset=utf-8",
                        data : $('#reply_form').serialize(),
                        dataType : "json",
                        success : function (){
                            console.log("Write Reply Success");
                            $('.reply_div').load(location.href+' .reply_div');
                            input.value ='';
                        },
                        error : function (request, status, error){
                            console.log("Write Reply Fail" + error);
                        }
                    });
                }
            });
            $(document).on('click', '.board_form_send', function() {
                console.log("Board Update 실행");
                $.ajax({
                    url:'/board/detail/update',
                    type:'get',
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    data : $('#board_form').serialize(),
                    success : function (message){
                        console.log("Board Update Success");
                        $('.form_refresh').load(window.location.href+' .form_refresh');
                        $("#isUpdatedForm").html('<div id="isUpdated"></div>');
                        $("#isUpdated").replaceWith(message);
                    },
                    error : function (request, status, error){
                        console.log("Board Update " + error);
                    }
                });
            });
        })
    </script>

</body>
</html>