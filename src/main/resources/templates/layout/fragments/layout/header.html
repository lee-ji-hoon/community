<!DOCTYPE html>
<html lang="ko"
      class="no-js"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns="http://www.w3.org/1999/html">

    <body>
        <header th:fragment="header" id="header_frag">
            <noscript>
                이 사이트의 기능을 모두 활용하기 위해서는 자바스크립트를 활성화 시킬 필요가 있습니다.
                <a href="http://www.enable-javascript.com/ko/" target="_blank"> 브라우저에서 자바스크립트를 활성화하는 방법</a>을 참고 하세요.
            </noscript>
            <div id="loadingSpin">
                <div style="border-top-color:transparent" class="w-16 h-16 border-4 border-blue-400 border-solid rounded-full animate-spin"></div>
            </div>
            <div class="header_wrap">
                <div class="header_inner mcontainer">
                    <div class="left_side">
                        <span class="slide_menu" uk-toggle="target: #wrapper ; cls: is-collapse is-active">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                <path d="M3 4h18v2H3V4zm0 7h12v2H3v-2zm0 7h18v2H3v-2z" fill="currentColor"></path>
                            </svg>
                        </span>
                        <div id="logo">
                            <a th:href="@{/}">
                                <img src="/assets/images/logo.png" alt="">
                                <img src="/assets/images/logo-mobile.png" class="logo_mobile" alt="">
                            </a>
                        </div>
                    </div>

                    <!-- search icon for mobile -->
                    <th:block sec:authorize="isAuthenticated()">
                        <div class="header-search-icon" uk-toggle="target: #wrapper ; cls: show-searchbox"> </div>
                        <div class="header_search">
                            <form id="searchForm" th:action="@{/search/lists}" method="post">
                                <div class="flex items-center">
                                    <select class="w-4 h-4 fill-current text-blue-500 ml-4 z-10 bg-gray-200" name="searchType">
                                        <option value="" selected>검색 분류를 선택해주세요.</option>
                                        <option value="동아리">동아리</option>
                                        <option value="커뮤니티">커뮤니티</option>
                                        <option value="장터">장터</option>
                                        <option value="학생회">학생회 공지 및 행사</option>
                                    </select>
                                    <input type='text' placeholder="검색어를 입력해주세요." name="keyword" autocomplete="off"
                                           class="w-full -ml-8 pl-10 px-4 py-2 border rounded-lg text-gray-700 focus:outline-none focus:border-green-500"/>
                                    <button type="submit" id="search_btn">
                                        <svg class="w-4 h-4 fill-current text-blue-500 -ml-8 z-10" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </th:block>

                    <div class="right_side">
                        <div sec:authorize="isAnonymous()" class="header_widgets">
                            <a href="#">
                                <img data-id="Anthony" width="24" height="24" class="identicon is_avatar"/>
                            </a>
                            <div uk-drop="mode: click;offset:4" class="header_dropdown profile_dropdown">
                                <a th:href="@{/login}">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                    </svg>
                                    로그인
                                </a>
                                <hr>
                                <a th:href="@{/sign-up}">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"></path>
                                    </svg>
                                    회원가입
                                </a>
                            </div>
                        </div>
                        <div sec:authorize="isAuthenticated()" class="header_widgets" th:with="account = ${#authentication.getPrincipal().getAccount()}">

                            <a href="#" class="is_icon" uk-tooltip="title: 알림">
                                <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path></svg>
                                <div class="refresh_alarm_count">
                                    <th:block th:if="${g_countByAccountAndNotChecked <= 9}">
                                        <span th:text="${g_countByAccountAndNotChecked}" class="pt-1">3</span>
                                    </th:block>
                                    <th:block th:if="${g_countByAccountAndNotChecked > 9}">
                                        <span class="pt-1">9+</span>
                                    </th:block>
                                </div>
                            </a>
                            <div uk-drop="mode: click" class="header_dropdown ">
                                <div  class="dropdown_scrollbar">
                                    <div class="drop_headline">
                                        <h4>알림 </h4>
                                        <div class="btn_action">
                                            <a href="#" th:href="@{/profile/settings/alarm}" data-tippy-placement="left" title="설정">
                                                <ion-icon name="settings-outline"></ion-icon>
                                            </a>
                                            <a onclick="alarmChecked()" data-tippy-placement="left" title="모두 읽기">
                                                <ion-icon name="checkbox-outline"></ion-icon>
                                            </a>
                                        </div>
                                    </div>
                                    <div>
                                        <ul>
                                            <div class="refresh_alarm">
                                                <li th:each="alarm : ${g_accountAlarmNotChecked}">
                                                    <a th:href="@{'/alarm/detail/' + ${alarm.alarmId}}">
                                                        <div class="drop_avatar">
                                                            <img th:if="${#strings.isEmpty(alarm.fromAccount.profileImage)}"
                                                                 th:data-id="${alarm.fromAccount.studentId}"
                                                                 alt="" class="identicon user_avatar" style="width: 45px; height: 45px;"/>
                                                            <img th:if="${!#strings.isEmpty(alarm.fromAccount.profileImage)}"
                                                                 th:src="${alarm.fromAccount.profileImage}"
                                                                 alt="" class=" shadow user_avatar" style="width: 45px; height: 45px;"/>
                                                        </div>
                                                        <span th:if="${alarm.alarmType.equals(alarm.alarmType.LIKES)}" class="drop_icon bg-gradient-primary">
                                                     <i class="icon-feather-thumbs-up"></i>
                                                </span>
                                                        <div class="drop_text">
                                                            <p>
                                                                <strong th:text="${alarm.fromAccount.nickname}"> ezhoon </strong>
                                                                <span th:if="${alarm.alarmType.equals(alarm.alarmType.LIKES)}">님이 회원님의 글을 좋아합니다.</span>
                                                                <span th:if="${alarm.alarmType.equals(alarm.alarmType.BOARD_REPLY)}">님의 게시글에 댓글이 달렸습니다.</span>
                                                                <span th:if="${alarm.alarmType.equals(alarm.alarmType.MEETING_REPLY)}">님이 모임글에 댓글이 달렸습니다.</span>
                                                                <span th:if="${alarm.alarmType.equals(alarm.alarmType.MEETING)}">님의 동아리에 모임이 생성됐습니다.</span>
                                                                <span th:if="${alarm.alarmType.equals(alarm.alarmType.STUDY)}">님의 관심사에 해당하는 동아리가 생성됐습니다.</span>
                                                                <br>
                                                                <span th:text="${alarm.message}" class="text-link">게시물 제목 </span>
                                                            </p>
                                                            <time th:text="${account.dateTime(alarm.createAlarmTime)}"> 2시간 전 </time>
                                                        </div>
                                                    </a>
                                                </li>
                                                <div th:if="${g_countByAccountAndNotChecked > 4}"
                                                     class="flex justify-center">
                                                    <span class="font-bold" th:text="${g_countByAccountAndNotChecked} - 3"></span> 개의 알림이 더 있습니다.
                                                </div>
                                                <div class="flex justify-center">
                                                    <a th:href="@{/alarm/view}"
                                                       class="bg-white text-center font-semibold my-3 px-6 py-2 rounded-full shadow-md dark:bg-gray-800 dark:text-white">
                                                        전체 보기
                                                    </a>
                                                </div>
                                            </div>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Message -->
                            <a href="#" class="is_icon" uk-tooltip="title: 쪽지">
                                <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"></path></svg>
                                <div class="refresh_chat_count">
                                    <th:block th:if="${g_chatNotify.size() <= 9}">
                                        <span class="pt-1" th:text="${g_chatNotify.size()}"></span>
                                    </th:block>
                                    <th:block th:if="${g_chatNotify.size() > 9}">
                                        <span class="pt-1">9+</span>
                                    </th:block>
                                </div>
                            </a>
                            <div uk-drop="mode: click" class="header_dropdown is_message">
                                <div  class="dropdown_scrollbar">
                                    <div class="drop_headline">
                                        <h4> 쪽지 </h4>
                                        <div class="btn_action">
                                            <a onclick="chatChecked()" data-tippy-placement="left" title="모두 읽음">
                                                <ion-icon name="checkbox-outline"></ion-icon>
                                            </a>
                                        </div>
                                    </div>
                                    <!--<input type="text" class="uk-input" placeholder="쪽지를 검색해보세요.">-->
                                    <ul>
                                        <div class="refresh_chat">
                                            <th:block th:each="myRoom : ${g_myRoom}">
                                                <th:block th:if="${!myRoom.getChatList().get(myRoom.getChatList().size()-1).getReadChk()}">
                                                    <th:block th:if="${!myRoom.getChatList().get(myRoom.getChatList().size()-1).getSender().getNickname().equals(account.getNickname())}">
                                                        <li class="un-read">
                                                            <a th:href="@{/chat/lists}">
                                                                <div class="drop_avatar">
                                                                    <th:block th:if="${myRoom.getRoomHost().getNickname().equals(account.getNickname())}">
                                                                        <img th:if="${#strings.isEmpty(myRoom.getRoomAttender()?.profileImage)}"
                                                                             th:data-id="${myRoom.getRoomAttender().studentId}"
                                                                             class="identicon jdenticon_fix"
                                                                             style="width: 45px; height: 45px;"
                                                                             alt=""/>
                                                                        <img th:if="${!#strings.isEmpty(myRoom.getRoomAttender()?.profileImage)}"
                                                                             th:src="${myRoom.getRoomAttender()?.profileImage}"
                                                                             style="width: 45px; height: 45px;"
                                                                             alt=""/>
                                                                    </th:block>
                                                                    <th:block th:if="${myRoom.getRoomAttender().getNickname().equals(account.getNickname())}">
                                                                        <img th:if="${#strings.isEmpty(myRoom.getRoomHost()?.profileImage)}"
                                                                             th:data-id="${myRoom.getRoomHost().studentId}"
                                                                             class="identicon jdenticon_fix"
                                                                             style="width: 45px; height: 45px;"
                                                                             alt=""/>
                                                                        <img th:if="${!#strings.isEmpty(myRoom.getRoomHost()?.profileImage)}"
                                                                             th:src="${myRoom.getRoomHost()?.profileImage}"
                                                                             style="width: 45px; height: 45px;"
                                                                             alt=""/>
                                                                    </th:block>
                                                                </div>
                                                                <div class="drop_text">
                                                                    <th:block th:if="${myRoom.getRoomAttender().getNickname().equals(account.getNickname())}">
                                                                        <strong th:text="${myRoom.getRoomHost().getNickname()}"> 닉네임 </strong><span class="font-bold" style="color: #4761FF" th:text="| (${g_chatService.unReadCount(myRoom)})|"> (2)</span>
                                                                    </th:block>
                                                                    <th:block th:if="${myRoom.getRoomHost().getNickname().equals(account.getNickname())}">
                                                                        <strong th:text="${myRoom.getRoomAttender().getNickname()}"> 닉네임 </strong><span class="font-bold" style="color: #4761FF" th:text="| (${g_chatService.unReadCount(myRoom)})|"> (2)</span>
                                                                    </th:block>
                                                                    <time th:text="${account.dateTime(myRoom.getLastSendTime())}">시간</time><br>
                                                                    <p th:text="${myRoom.getLastSendMsg()}">마지막 대화</p>
                                                                </div>
                                                            </a>
                                                        </li>
                                                    </th:block>
                                                </th:block>
                                            </th:block>
                                        </div>
                                    </ul>
                                </div>
                                <div class="flex justify-center">
                                    <a th:href="@{/chat/lists}"
                                       class="bg-white text-center font-semibold my-3 px-6 py-2 rounded-full shadow-md dark:bg-gray-800 dark:text-white">
                                        전체 보기
                                    </a>
                                </div>
                            </div>
                            <a href="#">
                                <img th:if="${#strings.isEmpty(account?.profileImage)}"
                                     th:data-id="${account.studentId}"
                                     width="24" height="24" class="identicon is_avatar"/>
                                <img th:if="${!#strings.isEmpty(account?.profileImage)}" th:src="${account.profileImage}"
                                     width="24" height="24" class="is_avatar"/>
                            </a>
                            <div uk-drop="mode: click;offset:4" class="header_dropdown profile_dropdown">

                                <a href="#" th:href="@{'/profile/' + ${account.nickname} + '/view'}" class="user">
                                    <div class="user_avatar">
                                        <img th:if="${#strings.isEmpty(account?.profileImage)}"
                                             class="identicon user_avatar jdenticon_fix" style="object-fit: cover"
                                             th:data-id="${account.studentId}"/>
                                        <img th:if="${!#strings.isEmpty(account?.profileImage)}" class="user_avatar"
                                             th:src="${account.profileImage}"/>
                                    </div>
                                    <div class="user_name">
                                        <div class="user_name">
                                            <div th:text="${account.nickname}">유저이름</div>
                                            <span th:text="${account.studentId}">유저 학번</span>
                                        </div>
                                    </div>
                                </a>
                                <hr>
                                <a th:href="@{/profile/settings/profile-settings}">
                                    <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path></svg>
                                    설정
                                </a>
                                <hr>
                                <a href="#" id="night-mode" class="btn-night-mode">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                                    </svg>
                                    다크 모드
                                    <span class="btn-night-mode-switch">
                                    <span class="uk-switch-button"></span>
                                </span>
                                </a>
                                <form action="#" name="logout" th:action="@{/logout}" method="post">
                                    <a href="javascript:logout.submit();">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                                            </path>
                                        </svg>
                                        로그아웃
                                    </a>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </body>
</html>