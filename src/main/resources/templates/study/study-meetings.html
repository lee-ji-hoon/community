<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="theme-fragments.html :: head"></head>

<style>
    .updateSubmit{
        display: none;
    }
</style>

<body>

<div id="wrapper">

    <!-- Header -->
    <header th:replace="theme-fragments.html :: header"></header>

    <!-- sidebar -->
    <div th:replace="theme-fragments.html :: side_bar"></div>

    <div class="main_content">
        <div class="mcontainer">
            <div th:replace="theme-fragments.html :: study-menu (currentStudyMenu = 'meeting')"></div>

            <div id="create-post-modal"  uk-modal>
                <div class="uk-modal-dialog">
                    <button class="uk-modal-close-default hover:bg-gray-100 rounded-full p-2.5 block uk-icon uk-close mt-0.5"
                            type="button" uk-close>
                        <i class="icon-feather-close"></i>
                    </button>

                    <div class="uk-modal-header">
                        <h3 class="text-lg font-semibold" id="forum_head"> 일정 작성하기 </h3>
                    </div>
                    <!--일정 폼-->
                    <form class="needs-validation space-y-4 g:w-8/12" id="board_form"
                          th:object="${meetingsForm}"
                          th:action="@{'/study/' + ${study.getPath()} + '/meetings'}"
                          method="post" novalidate>
                        <div class="uk-modal-body" uk-overflow-auto>
                            <div class="space-y-4 g:w-8/12">
                                <div class="font-semibold text-lg"> 자세한 내용 </div>
                                <!-- 제목 -->
                                <div class="form-group">
                                    <div class="line form-group">
                                        <input class="line__input form-control" id="title" th:field="*{meetingTitle}"
                                               type="text" onkeyup="this.setAttribute('value', this.value);"
                                               aria-describedby="titleHelp" required autocomplete="off">
                                        <span for="username" class="line__placeholder"> 제목 </span>
                                    </div>
                                    <small id="titleHelp" class="form-text text-muted">
                                        제목은 5글자부터 최대 30글자까지 입력 가능합니다.
                                    </small>
                                    <small class="invalid-feedback">제목을 입력해주세요.</small>
                                    <small class="form-text text-danger" th:if="${#fields.hasErrors('meetingTitle')}" th:errors="*{meetingTitle}">meetingTitle Error</small>
                                </div>

                                <!-- 위치 -->
                                <div id="meetingPlaces" class="form-group">
                                    <div class="line form-group">
                                        <input class="line__input form-group" id="places" th:field="*{meetingPlaces}"
                                               type="text" onkeyup="this.setAttribute('value', this.value);"
                                               aria-describedby="subTitleHelp" required autocomplete="off">
                                        <span for="username" class="line__placeholder"> 위치 </span>
                                    </div>
                                    <small class="invalid-feedback">스터디를 진행할 곳을 적어주세요..</small>
                                    <small id="meetingPlacesHep" class="form-text text-muted">
                                        스터디를 진행할 곳을 적어주세요.
                                    </small>
                                    <small class="form-text text-danger" th:if="${#fields.hasErrors('meetingPlaces')}" th:errors="*{meetingPlaces}">meetingPlaces Error</small>
                                </div>

                                <!-- 주제 -->
                                <div id="meetingMethod" class="form-group">
                                    <div class="line form-group -mb-3">
                                        <label for="meetingMethod">일정 주제 선택</label>
                                    </div>
                                    <select class="selectpicker" th:field="*{meetingMethod}" multiple>
                                        <option th:each="tags : ${study.tags}" th:value="${tags.title}" th:text="${tags.title}">Option 1</option>
                                    </select>
                                    <small id="meetingMethodHelp" class="form-text text-muted mt-3">
                                        스터디에 등록된 태그중의 주제를 선택할 수 있습니다.
                                    </small>
                                    <small class="invalid-feedback">다시 선택해주세요.</small>
                                    <small class="form-text text-danger" th:if="${#fields.hasErrors('meetingMethod')}" th:errors="*{meetingMethod}">meetingMethod Error</small>
                                </div>

                                <!-- 본문 -->
                                <div class="form-group">
                                    <div class="line form-group">
                                        <label for="meetingDescription">상세 소개</label>
                                        <textarea id="meetingDescription" type="text" name="meetingDescription"
                                                  th:field="*{meetingDescription}" class="shadow-none with-border p-3 form-control"
                                                  placeholder="스터디를 자세히 설명해 주세요." aria-describedby="fullDescriptionHelp" required></textarea>
                                        <small id="meetingDescriptionHelp" class="form-text text-muted">
                                            목표, 일정, 진행방식, 위치, 모집인원 등 최대한 자세히 적어주세요
                                        </small>
                                        <small class="invalid-feedback">자세한 일정을 공유해주세요.</small>
                                        <small class="form-text text-danger" th:if="${#fields.hasErrors('meetingDescription')}" th:errors="*{meetingDescription}">meetingDescription Error</small>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="uk-modal-footer uk-text-right">
                            <button class="bg-red-600 font-medium h-9 items-center justify-center px-5 rounded-md text-white text-sm uk-modal-close"
                                    type="button">취소</button>

                            <button type="submit"
                                    class="board_form_send bg-blue-600 h-9 items-center justify-center rounded-md text-white px-5 font-medium">저장</button>
                        </div>
                    </form>
                </div>
            </div>


            <!--모임 내용-->
            <div class="lg:mt-8 mt-4">
                <div id="isUpdatedForm">
                    <div id="isUpdated"></div>
                </div>

                <div class="md:flex md:space-x-6">
                    <div class="space-y-5 flex-shrink-0 md:w-7/12">
                        <div th:if="${study.isManager(#authentication.principal)}"class="card lg:mx-0 p-4" uk-toggle="target: #create-post-modal"
                             href="#create-post-modal">
                            <div class="flex space-x-3">
                                <svg th:if="${#strings.isEmpty(account.profileImage)}"
                                     th:data-jdenticon-value="${account.studentId}"
                                     class="w-10 h-10 rounded-full">
                                </svg>
                                <img th:if="${!#strings.isEmpty(account.profileImage)}"
                                     th:src="${account.profileImage}" alt=""
                                     class="w-10 h-10 rounded-full">
                                <input placeholder="일정을 등록해주세요." class="bg-gray-100 hover:bg-gray-200 flex-1 h-10 px-6 rounded-full">
                            </div>
                        </div>
                        <div th:if="${message}">
                            <div th:replace="theme-fragments.html :: blue-notice(message=${message})"></div>
                        </div>
                        <!-- 모임 view  -->
                        <div class="form_refresh">
                            <div th:each="meeting : ${meetingsList}"
                             class="card lg:mx-0 uk-animation-slide-bottom-small mb-5">
                            <!--<div th:if="${isReportedReplyMessage}">
                                <div th:replace="theme-fragments.html :: red-notice(message=${isReportedReplyMessage})"></div>
                            </div>
                            <div th:if="${reportCompleteMessage}">
                                <div th:replace="theme-fragments.html :: blue-notice(message=${reportCompleteMessage})"></div>
                            </div>-->
                                <div>
                                    <div th:id="'create-modal' + ${meeting.meetingsId}" uk-modal>
                                        <div class="uk-modal-dialog">
                                            <button class="uk-modal-close-default hover:bg-gray-100 rounded-full p-2.5 block uk-icon uk-close mt-0.5"
                                                    type="button" uk-close>
                                                <i class="icon-feather-close"></i>
                                            </button>

                                            <div class="uk-modal-header">
                                                <h3 class="text-lg font-semibold" id="update-head"> 일정 수정 </h3>
                                            </div>
                                            <!--일정 수정 폼-->
                                            <form class="needs-validation space-y-4 g:w-8/12"
                                                  th:id="|updateForm${meeting.meetingsId}|"
                                                  onsubmit="return false" novalidate>
                                                <div class="uk-modal-body" uk-overflow-auto>
                                                    <div class="space-y-4 g:w-8/12">
                                                        <input type="hidden" th:value="${meeting.meetingsId}" name="meetingId" readonly>
                                                        <div class="font-semibold text-lg"> 자세한 내용 </div>
                                                        <!-- 제목 -->
                                                        <div class="form-group">
                                                            <div class="line form-group">
                                                                <input class="line__input form-control" name="updateTitle" id="updateTitle" th:value="${meeting.meetingTitle}"
                                                                       type="text" onkeyup="this.setAttribute('value', this.value);"
                                                                       aria-describedby="titleHelp" required autocomplete="off">
                                                                <span for="username" class="line__placeholder"> 제목 </span>
                                                            </div>
                                                            <small id="updateTitleHelp" class="form-text text-muted">
                                                                제목은 5글자부터 최대 30글자까지 입력 가능합니다.
                                                            </small>
                                                            <small class="invalid-feedback">제목을 입력해주세요.</small>
                                                        </div>

                                                        <!-- 위치 -->
                                                        <div id="updateMeetingPlaces" class="form-group">
                                                            <div class="line form-group">
                                                                <input class="line__input form-group" name="updatePlaces" id="updatePlaces" th:value="${meeting.meetingPlaces}"
                                                                       type="text" onkeyup="this.setAttribute('value', this.value);"
                                                                       aria-describedby="subTitleHelp" required autocomplete="off">
                                                                <span for="username" class="line__placeholder"> 위치 </span>
                                                            </div>
                                                            <small class="invalid-feedback">스터디를 진행할 곳을 적어주세요..</small>
                                                            <small id="updateMeetingPlacesHelp" class="form-text text-muted">
                                                                스터디를 진행할 곳을 적어주세요.
                                                            </small>
                                                        </div>

                                                        <!-- 주제 -->
                                                        <div id="updateMeetingMethod" class="form-group">
                                                            <div class="line form-group -mb-3">
                                                                <label for="updateMeetingMethod">일정 주제 선택</label>
                                                            </div>
                                                            <select class="selectpicker" id="updateMethod" name="updateMethod" th:value="${meeting.meetingMethod}" multiple>
                                                                <option th:each="tags : ${study.tags}" th:value="${tags.title}" th:text="${tags.title}">Option 1</option>
                                                            </select>
                                                            <small id="updateMeetingMethodHelp" class="form-text text-muted mt-3">
                                                                스터디에 등록된 태그중의 주제를 선택할 수 있습니다.
                                                            </small>
                                                            <small class="invalid-feedback">다시 선택해주세요.</small>
                                                        </div>

                                                        <!-- 본문 -->
                                                        <div class="form-group">
                                                            <div class="line form-group">
                                                                <label for="updateMeetingDescription">상세 소개</label>
                                                                <textarea id="updateMeetingDescription" type="text" name="updateMeetingDescription"
                                                                          th:utext="${meeting.meetingDescription}" class="shadow-none with-border p-3 form-control"
                                                                          placeholder="스터디를 자세히 설명해 주세요." aria-describedby="fullDescriptionHelp" required></textarea>
                                                                <small id="updateMeetingDescriptionHelp" class="form-text text-muted">
                                                                    목표, 일정, 진행방식, 위치, 모집인원 등 최대한 자세히 적어주세요
                                                                </small>
                                                                <small class="invalid-feedback">자세한 일정을 공유해주세요.</small>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>

                                                <div class="uk-modal-footer uk-text-right">
                                                    <button
                                                            class="bg-red-600 font-medium h-9 items-center justify-center px-5 rounded-md text-white text-sm uk-modal-close"
                                                            type="button">취소</button>
                                                    <button
                                                            class="bg-blue-600 h-9 items-center justify-center rounded-md text-white px-5 font-medium uk-modal-close"
                                                            th:onclick="|updateMeeting.updateMeetingAjax(${meeting.meetingsId})|"
                                                            id="board_form_update">저장
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <!-- 헤더 -->
                                    <div class="flex justify-between items-center lg:p-4 p-2.5">
                                        <div class="flex flex-1 items-center space-x-4">
                                            <a href="#">
                                                <svg th:if="${#strings.isEmpty(meeting.writer.profileImage)}"
                                                     th:data-jdenticon-value="${meeting.writer.studentId}"
                                                     class="border border-white rounded-full w-10 h-10">
                                                </svg>
                                                <img th:if="${!#strings.isEmpty(meeting.writer.profileImage)}"
                                                     th:src="${meeting.writer.profileImage}" alt=""
                                                     class=" border border-white rounded-full w-10 h-10">
                                            </a>
                                            <div class="flex-1 font-semibold capitalize">
                                                <a th:text="${meeting.writer.nickname}" href="#" class="text-black dark:text-gray-100"> Johnson smith </a>
            <!--                                        <div th:text="${meeting.meetingDivision}" class="text-sm"></div>-->
                                                <div class="text-sm" th:text="${service.meetingDateTime(meeting.uploadTime)}"></div>
            <!--                                        <span th:text="${#temporals.format(meeting.uploadTime,  'yyyy-MM-dd')}"></span>-->
                                            </div>
                                        </div>

                                        <div th:if="${account.username.equals(meeting.writer.username)}">
                                            <a href="#">
                                                <i class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition -mr-1 dark:hover:bg-gray-700"></i>
                                            </a>
                                            <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100 dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700"
                                                 uk-drop="mode: click;pos: bottom-right;animation: uk-animation-slide-bottom-small">
                                                <ul class="space-y-1">
                                                    <li>
                                                        <a th:href="'#create-modal' + |${meeting.meetingsId}|" uk-toggle
                                                           class="flex items-center px-3 py-2 hover:bg-gray-200 hover:text-gray-800 rounded-md dark:hover:bg-gray-800">
                                                            <i class="uil-edit-alt mr-1"></i> 수정
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a th:href="@{'/study/' + ${study.path} + '/meetings/' + ${meeting.meetingsId}}" class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md dark:hover:bg-red-600">
                                                            <i class="uil-trash-alt mr-1"></i> 삭제
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 내용 -->
                                    <div class=" p-5">
                                        <div href="#"
                                           class="text-xl font-semibold"
                                           th:text="${meeting.meetingTitle}">
                                        </div>

                                        <div class="text-lg mt-5" th:utext="${meeting.meetingDescription}">
                                        </div>
                                        <div th:if="${meeting.meetingMethod != null}" class="job-tags mt-5 mb-2 space-x-2.5 space-y-2">
                                            <a th:each="tags : ${service.getMeetingTagsList(meeting)}" th:text="${tags}" href="#" class="border px-3 py-1.5 rounded-md text-sm inline-block"> Wordpress </a>
                                        </div>
                                        <div th:if="${meeting.meetingMethod == null}" class="job-tags mt-5 space-x-2.5 space-y-2">
                                            <span class="font-semibold"> 주제가 선정 되지 않은 일정입니다.</span>
                                        </div>
                                    </div>

                                    <!-- 댓글 -->
                                    <div class=" px-6 relative">
                                        <div class="bg-gray-100 rounded-full relative dark:bg-gray-800 mb-2">
                                            <form th:id="|reply_form${meeting.meetingsId}|" onsubmit="return false">
                                                <input type="hidden" id="r_meetings_id" name="r_meetings_id" class="form-control"
                                                       value="1" th:value="${meeting.meetingsId}" readonly>
                                                <input type="hidden" id="r_account_id" name="r_account_id" class="form-control"
                                                       value="1" th:value="${account.id}" readonly>
                                                <input placeholder="댓글을 입력해주세요." class="bg-transparent max-h-10 shadow-none px-5"
                                                       th:id="|r_content${meeting.meetingsId}|" name="r_content">
                                                <div class="-m-0.5 absolute bottom-0 flex items-center right-3 text-xl">
                                                    <span th:id="|replySubmit${meeting.meetingsId}|"
                                                          th:onclick="|replyBtn.replyAjax(${meeting.meetingsId})|">
                                                        <ion-icon name="return-down-back-outline" class="hover:bg-gray-200 p-1.5 rounded-full"></ion-icon>
                                                    </span>
                                                </div>
                                            </form>
                                        </div>
                                        <div th:id="|reply_div${meeting.meetingsId}|">
                                            <div class="py-4 space-y-4 dark:border-gray-600">
                                                <div class="flex" th:each="reply : ${service.replyList(meeting)}">
                                                    <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                                                        <a th:href="@{/profile/{nickname}(nickname = ${reply.getAccount().nickname})}">
                                                            <svg th:if="${#strings.isEmpty(reply.getAccount()?.profileImage)}"
                                                                 th:data-jdenticon-value="${reply.getAccount().studentId}"
                                                                 alt="" class="absolute h-full rounded-full w-full"></svg>
                                                            <img th:if="${!#strings.isEmpty(reply.getAccount()?.profileImage)}"
                                                                 th:src="${reply.getAccount()?.profileImage}"
                                                                 alt="" class="absolute h-full rounded-full w-full"/>
                                                        </a>
                                                    </div>
                                                    <div>
                                                        <form onsubmit="return false" th:id="|replyUpdateForm${reply.rid}|">
                                                            <div class="text-gray-700 py-2 px-3 rounded-md bg-gray-100 relative lg:ml-5 ml-2 lg:mr-12 dark:bg-gray-800 dark:text-gray-100">
                                                                <input type="hidden" th:value="${reply.rid}" name="reply_update_rid">
                                                                <p class="leading-6" th:text="${reply.content}" th:id="|orginalReply${reply.rid}|"></p>
                                                                <input type="hidden" th:value="${reply.content}" name="reply_update_content" th:id="|replyUpdateInput${reply.rid}|">
                                                                <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-100 transform rotate-45 dark:bg-gray-800"></div>
                                                            </div>
                                                        </form>

                                                        <div class="text-xs flex items-center space-x-3 mt-2 ml-5">
                                                            <span th:text="${service.meetingDateTime(reply.uploadTime)}"></span>
                                                            <th:block th:if="${reply.getAccount().id == account.id}">
                                                            <span class="text-blue-500"
                                                                  th:onclick="|updateBtn.replyUpdate(${reply.rid})|"
                                                                  th:id="|replyUpdateBtn${reply.rid}|"> 수정 </span>
                                                                <span class="text-blue-500 updateSubmit"
                                                                      th:onclick="|updateComplete.replyUpdateAjax(${reply.rid})|"
                                                                      th:id="|replyUpdateSubmit${reply.rid}|"> 등록 </span>
                                                                <span class="text-red-500"
                                                                      th:onclick="|deleteReplyBtn.deleteReply(${reply.rid})|"
                                                                      th:id="|replyDeleteSubmit${reply.rid}|"> 삭제 </span>
                                                                <form onsubmit="return false" th:id="|replyDeleteForm${reply.rid}|" class="d-none">
                                                                    <input type="hidden" th:value="${reply.rid}" name="reply_delete_rid">
                                                                </form>
                                                            </th:block>
                                                            <th:block th:if="${reply.getAccount().id != account.id}">
                                                                <a th:href="@{/reply/report/{rid}(rid = ${reply.rid})}" class="text-red-600"> <i class="fa fa-bullhorn"></i> 신고 </a>
                                                            </th:block>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-center mt-6">
                            <a href="#" class="bg-white font-semibold my-3 px-6 py-2 rounded-full shadow-md dark:bg-gray-800 dark:text-white">
                                더 보기</a>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="w-full space-y-6">
                        <div uk-sticky="media @m ; offset:80 ; bottom : true">
                            <div class="widget card p-5">
                                <h4 class="text-lg font-semibold"> 스터디 주요 관심사 </h4>
                                <h5 class="text-lg font-semibold" th:if="${study.tags.size() == 0}">
                                    스터디 주제가 아직 등록되지 않았습니다.
                                </h5>

                                <ul class="text-gray-600 space-y-3 mt-3" th:if="${study.tags.size() != 0}">
                                    <li class="flex items-center space-x-2" th:each="tag : ${study.tags}">
                                        <a class="text-decoration-none text-white">
                                            #<span th:text="${tag.title}">Tag</span>
                                        </a>
                                    </li>
                                </ul>
                                <a href="#" th:href="@{'/study/' + ${study.path} + '/settings/tags'}" class="button gray mt-3 w-full"> 스터디 관심사 추가 </a>
                            </div>

                            <div class="widget card p-5 border-t mt-5">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h4 class="text-lg font-semibold"> 인원 </h4>
                                        <p class="text-sm" th:text="${study.memberCount} + '명 참여 중'"> 3,4510 Friends</p>
                                    </div>
                                </div>

                                <div class="grid grid-cols-3 gap-3 text-gray-600 font-semibold justify-items-center">
                                    <a th:each="managers : ${study.managers}" th:href="@{'/profile/' + ${managers.nickname}}" style="width:64px" class="text-center">
                                        <div class="avatar relative rounded-md overflow-hidden w-16 h-16 mb-2 place-content-center">
                                            <svg th:if="${#strings.isEmpty(managers.profileImage)}"
                                                 th:data-jdenticon-value="${managers.studentId}"
                                                 class="border border-white rounded-full w-full h-full object-cover absolute is_avatar">

                                            </svg>
                                            <img th:if="${!#strings.isEmpty(managers.profileImage)}"
                                                 th:src="${managers.profileImage}" alt=""
                                                 class="border border-white rounded-full w-full h-full object-cover absolute is_avatar">
                                        </div>
                                        <span th:text="${managers.nickname}" class="text-center text-sm"> 유저 닉네임 </span> <i class="fa fa-id-badge"></i>
                                    </a>
                                    <a th:each="member : ${study.members}" th:href="@{'/profile/' + ${member.nickname}}" class="text-center">
                                        <div class="avatar relative rounded-md overflow-hidden w-16 h-16 mb-2 place-content-center">
                                            <svg th:if="${#strings.isEmpty(member.profileImage)}"
                                                 th:data-jdenticon-value="${member.studentId}"
                                                 class="border border-white rounded-full w-full h-full object-cover absolute is_avatar">

                                            </svg>
                                            <img th:if="${!#strings.isEmpty(member.profileImage)}"
                                                 th:src="${member.profileImage}" alt=""
                                                 class="border border-white rounded-full w-full h-full object-cover absolute is_avatar">
                                        </div>
                                        <span th:text="${member.nickname}" class="text-center text-sm truncate"> 유저 닉네임 </span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 스터디 참여 인원 -->
<script th:replace="theme-fragments.html :: studyBanner"></script>
<script th:replace="theme-fragments.html :: form-validation"></script>

<link  href="/node_modules/cropper/dist/cropper.min.css" rel="stylesheet">
<script src="/node_modules/cropper/dist/cropper.min.js"></script>
<script src="/node_modules/jquery-cropper/dist/jquery-cropper.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

<script th:inline="javascript">
    // 댓글 작성 ajax
    let replyBtn={
        replyAjax: function (meetingsId) {

            const delay = (function () {
                let timer = 0;
                return function (callback, ms) {
                    clearTimeout(timer);
                    timer = setTimeout(callback, ms);
                };
            })();
            // 시간 지연
            var input = document.getElementById(`r_content${meetingsId}`);
            let keydown = true;
            if (input.value == '') {
                swal("댓글을 입력해주세요.");
            } else {
                $.ajax({
                    url: '/study/meetings/reply',
                    type: 'get',
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    data: $(`#reply_form${meetingsId}`).serialize(),
                    dataType: "json",
                }).done(function (fragment) {
                    $(`#reply_div${meetingsId}`).load(window.location.href + ` #reply_div${meetingsId}`);
                    keydown = false;
                    input.value = '';
                    $(input).attr("readonly",true);
                    $(input).attr("placeholder","5초 뒤에 댓글을 입력할 수 있습니다.");
                });
            }
            delay(function (){
                $(input).removeAttr("readonly");
                $(input).attr("placeholder","댓글을 입력해주세요.");
                keydown=true;
            }, 5000);
        }
    }

    let updateComplete = {
        replyUpdateAjax: function (replyId) {
            // 댓글 수정 ajax
            $.ajax({
                url:'/study/meetings/reply/update',
                type:'get',
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                data : $(`#replyUpdateForm${replyId}`).serialize(),
                dataType : "json",
                success : function (){
                    jQuery(`#orginalReply${replyId}`).show();
                    jQuery(`#replyUpdateBtn${replyId}`).show();
                    jQuery(`#replyUpdateSubmit${replyId}`).hide();
                    $('.form_refresh').load(location.href+' .form_refresh');
                    // $('.reply_div').load(location.href+' .reply_div');
                    $(`#replyUpdateInput${replyId}`).prop("type", "hidden");
                },
                error : function (request, status, error){
                }
            });
        }
    }
    // 게시글 업데이트

    let updateMeeting = {
        updateMeetingAjax: function (meetingsId){
            $.ajax({
                url:'/study/meetings/update',
                type:'get',
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                data : $(`#updateForm${meetingsId}`).serialize(),
                success : function (message){
                    $('.form_refresh').load(window.location.href+' .form_refresh');
                    location.reload();
                },
                error : function (request, status, error){
                }
            });
        }
    }

    let updateBtn = {
        replyUpdate: function (replyId) {
            jQuery(`#orginalReply${replyId}`).hide();
            jQuery(`#replyUpdateBtn${replyId}`).hide();
            jQuery(`#replyUpdateSubmit${replyId}`).show();
            $(`#replyUpdateInput${replyId}`).prop("type", "text");
        }
    }
    // 댓글 삭제
    let deleteReplyBtn = {
        deleteReply: function (replyId, meetingId) {
            swal({
                title: "댓글을 삭제하시겠습니까?",
                text: "삭제된 댓글은 복구할 수 없습니다.",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
                .then((willDelete) => {
                    window.addEventListener('keydown', function (e){
                        if (e.keyCode == 13) {
                            swal("엔터키는 사용할 수 없습니다.");
                        }
                    })
                    if (willDelete) {
                        $.ajax({
                            url:'/study/meetings/reply/delete',
                            type:'get',
                            contentType: "application/x-www-form-urlencoded; charset=utf-8",
                            data : $(`#replyDeleteForm${replyId}`).serialize(),
                            dataType : "json",
                            success : function (){
                                $('.form_refresh').load(location.href+' .form_refresh');
                            },
                            error : function (request, status, error){
                            }
                        });
                        swal("댓글이 삭제되었습니다.", {
                            icon: "success",
                        });
                    } else {
                        swal("댓글이 삭제되지 않았습니다. 다시 시도해주세요.");
                    }
                });
        }
    }

    $(document).ready(function() {
        //여기 아래 부분
        $('#meetingDescription, #updateMeetingDescription').summernote({
            height: 300,                 // 에디터 높이
            minHeight: null,             // 최소 높이
            maxHeight: null,             // 최대 높이
            focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
            lang: "ko-KR",					// 한글 설정
            toolbar: [
                ['font', ['bold', 'italic', 'underline', 'clear', 'codeblock']],
                ['mybutton', ['hello']],
                ['insert',['picture','link']],
            ],
            placeholder: '스터디 모집글을 아래 양식을 참고해 작성해주세요. <br> 꼼꼼히 작성하면 멋진 스터디 팀원을 만나실 수 있을거예요.  <br/> [개발 스터디 모집 내용 예시] <br/> 스터디 주제 : <br/> 스터디 목표 : ' //placeholder 설정

        });
        let name = [[ ${study.path} ]];
        history.replaceState('data to be passed', 'Title of the page', '/study/' + name + '/meetings');

    });
</script>
</body>

</html>